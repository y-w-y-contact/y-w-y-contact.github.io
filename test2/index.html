<!DOCTYPE html>
<html>
<head>
  <title>Merge Audio and Video</title>
  <script src="vendor/ffmpeg.min.js"></script>
</head>
<body>
  <h1>Merge Audio and Video</h1>

  <input type="file" id="audioFileInput" accept="audio/*">
  <br>
  <input type="file" id="videoFileInput" accept="video/*">
  <br>
  <button onclick="mergeFiles()">Execute</button>

  <script>
    async function mergeFiles() {
      const audioFileInput = document.getElementById('audioFileInput');
      const videoFileInput = document.getElementById('videoFileInput');

      const audioFile = audioFileInput.files[0];
      const videoFile = videoFileInput.files[0];

      if (!audioFile || !videoFile) {
        console.error('Please select audio and video files.');
        return;
      }

      const ffmpeg = createFFmpeg({
        log: true,
        corePath: 'vendor/ffmpeg-core.js',
      });

      await ffmpeg.load();

      const audioFileName = 'audio.mp4';
      const videoFileName = 'video.mp4';
      const outputFileName = 'output.mp4';

      await ffmpeg.write(audioFileName, await audioFile.arrayBuffer());
      await ffmpeg.write(videoFileName, await videoFile.arrayBuffer());

      await ffmpeg.run('-i', audioFileName, '-i', videoFileName, '-c', 'copy', outputFileName);

      const outputData = ffmpeg.read(outputFileName);
      const outputBlob = new Blob([outputData.buffer], { type: 'video/mp4' });

      // Do something with the merged output file
      // For example, you can download the merged file
      const downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(outputBlob);
      downloadLink.download = outputFileName;
      downloadLink.click();

      ffmpeg.FS('unlink', audioFileName);
      ffmpeg.FS('unlink', videoFileName);
      ffmpeg.FS('unlink', outputFileName);
      ffmpeg.exit();
    }

    // Create the createFFmpeg function
    function createFFmpeg(options) {
      const ffmpeg = FFmpeg.createFFmpeg(options);
      return {
        ...ffmpeg,
        load: () => new Promise(resolve => ffmpeg.load().then(() => resolve())),
        run: (...args) => new Promise(resolve => ffmpeg.run(...args).then(() => resolve())),
        write: (...args) => new Promise(resolve => ffmpeg.write(...args).then(() => resolve())),
        read: (...args) => ffmpeg.read(...args),
        exit: () => ffmpeg.exit(),
      };
    }
  </script>
</body>
</html>
